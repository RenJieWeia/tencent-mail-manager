<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}MailNest{% endblock %}</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css" rel="stylesheet">
    
    <style>
      :root {
        --primary-color: #4f46e5;
        --secondary-color: #64748b;
        --bg-color: #f8fafc;
        --surface-color: #ffffff;
        --text-primary: #0f172a;
        --text-secondary: #475569;
        --border-color: #e2e8f0;
      }
      
      body {
        background-color: var(--bg-color);
        font-family: 'Inter', system-ui, -apple-system, sans-serif;
        color: var(--text-primary);
        height: 100vh; /* Changed from min-height to height */
        overflow: hidden; /* Prevent body scroll */
        display: flex;
        flex-direction: column;
      }

      .navbar {
        background-color: var(--surface-color);
        border-bottom: 1px solid var(--border-color);
        height: 64px;
      }

      .navbar-brand {
        font-weight: 700;
        letter-spacing: -0.025em;
        color: var(--primary-color) !important;
      }
      
      .main-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden; /* 防止主滚动条 */
      }
      
      /* 通用卡片样式 */
      .card {
        border: 1px solid var(--border-color);
        box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
        border-radius: 0.75rem;
      }
      
      .btn-primary {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
      }
      
      .btn-primary:hover {
        background-color: #4338ca;
        border-color: #4338ca;
      }
      
      .btn-ghost {
        color: var(--text-secondary);
        background-color: transparent;
      }
      
      .btn-ghost:hover {
        background-color: #f1f5f9;
        color: var(--text-primary);
      }

      /* Toast Container Position */
      .toast-container {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        z-index: 1060;
      }
    </style>
    {% block styles %}{% endblock %}
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg sticky-top px-3 shadow-sm">
      <div class="container-fluid">
        <a href="/" class="d-flex align-items-center gap-2 text-decoration-none">
            <div class="d-flex align-items-center justify-content-center bg-primary text-white rounded-3" style="width: 32px; height: 32px;">
                <i class="bi bi-envelope-paper-fill"></i>
            </div>
            <span class="navbar-brand mb-0 h1 fs-5">MailNest</span>
            <span class="text-muted border-start ps-3 ms-2 small d-none d-sm-inline-block">QQ邮箱集中管理</span>
        </a>
        
        <div class="d-flex gap-3 align-items-center">
            {% if session.get('username') %}
            <div class="dropdown">
                <button class="btn btn-ghost d-flex align-items-center gap-2 text-decoration-none border-0 p-1 rounded-pill pe-3 hover-bg-light" type="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false" style="transition: background-color 0.2s;">
                    <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center shadow-sm" 
                         style="width: 36px; height: 36px; font-weight: 600; font-size: 14px;">
                        {{ session.get('username')[0].upper() }}
                    </div>
                    <div class="d-flex flex-column align-items-start lh-1 d-none d-sm-flex">
                        <span class="fw-semibold text-dark small">{{ session.get('username') }}</span>
                        <span class="text-secondary" style="font-size: 10px;">{% if session.get('username') == 'admin' %}管理员{% else %}用户{% endif %}</span>
                    </div>
                    <i class="bi bi-chevron-down text-muted small ms-1"></i>
                </button>
                <ul class="dropdown-menu dropdown-menu-end shadow border-0 mt-2 rounded-3 p-2" aria-labelledby="userDropdown" style="min-width: 200px;">
                    <li><h6 class="dropdown-header text-uppercase small fw-bold text-muted">我的账户</h6></li>
                    <li><a class="dropdown-item rounded-2 py-2" href="/profile"><i class="bi bi-person-gear me-2 text-secondary"></i>个人设置</a></li>
                    
                    {% if session.get('username') == 'admin' %}
                    <li><h6 class="dropdown-header text-uppercase small fw-bold text-muted mt-2">系统管理</h6></li>
                    <li><a class="dropdown-item rounded-2 py-2 text-primary" href="/admin/users"><i class="bi bi-people-fill me-2"></i>用户管理</a></li>
                    {% endif %}
                    
                    <li><hr class="dropdown-divider my-2"></li>
                    <li><a class="dropdown-item rounded-2 py-2 text-danger" href="/logout"><i class="bi bi-box-arrow-right me-2"></i>退出登录</a></li>
                </ul>
            </div>
            {% endif %}
        </div>
      </div>
    </nav>
    
    <!-- Main Content Area -->
    <main class="main-content">
        {% block content %}{% endblock %}
    </main>

    <!-- Global Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global Toast Function
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const id = 'toast-' + Date.now();
            const icon = type === 'success' ? 'check-circle-fill' : (type === 'danger' ? 'exclamation-circle-fill' : 'info-circle-fill');
            const color = type === 'success' ? 'success' : (type === 'danger' ? 'danger' : 'primary');
            
            const html = `
                <div id="${id}" class="toast align-items-center text-white bg-${color} border-0 shadow" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="d-flex">
                        <div class="toast-body d-flex align-items-center gap-2">
                            <i class="bi bi-${icon}"></i>
                            ${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                </div>
            `;
            
            const wrapper = document.createElement('div');
            wrapper.innerHTML = html;
            container.appendChild(wrapper.firstElementChild);
            
            const toastEl = document.getElementById(id);
            const toast = new bootstrap.Toast(toastEl, { delay: 3000 });
            toast.show();
            
            // Cleanup after hidden
            toastEl.addEventListener('hidden.bs.toast', () => {
                toastEl.remove();
            });
        }
    </script>
    {% block scripts %}{% endblock %}
  </body>
</html>